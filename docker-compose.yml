services:
  api:
    build:
      context: .
      dockerfile: api/Dockerfile
    container_name: api    
    volumes:
      - ./data:/app/data
    # 필요시 헬스체크 추가
    healthcheck:                      # ✅ nginx가 준비될 때까지 기다릴 수 있게 추가
      test: ["CMD", "curl", "-f", "http://localhost:5000/healthz"]
      interval: 5s
      timeout: 2s
      retries: 5
    expose:
      - "5000"

  web:
    image: nginx:1.25
    # api가 준비된 뒤 시작하도록 depends_on/healthcheck 구성 가능
    container_name: web
    depends_on:
      api:
        condition: service_healthy
    ports:
      - "8080:8080"
    volumes:
      - ./nginx/html:/usr/share/nginx/html:ro
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro